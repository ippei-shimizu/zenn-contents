---
title: "Reactã§é‡‘èæ©Ÿé–¢æ¤œç´¢APIã‚’ãŸãŸã„ã¦ã¿ã‚ˆã†"
emoji: "ğŸ¦Š"
type: "tech" # tech: æŠ€è¡“è¨˜äº‹ / idea: ã‚¢ã‚¤ãƒ‡ã‚¢
topics: ["react", "javascript", "webapi"]
published: false
---
## ã¯ã˜ã‚ã«
ä»Šå›ã¯ã€Reactã®å­¦ç¿’ã¨ã—ã¦ã€fetché–¢æ•°ã‚’ä½¿ç”¨ã—ã¦é‡‘èæ©Ÿé–¢æ¤œç´¢APIã‚’ãŸãŸã„ã¦ã€useStateãƒ»useEffectãªã©ã‚’ä½¿ç”¨ã—ã¦ã€éŠ€è¡Œåå…¥åŠ›ãƒ•ã‚©ãƒ¼ãƒ ã‚’å®Ÿè£…ã—ã¦ã¿ãŸã„ã¨æ€ã„ã¾ã™ã€‚
## æ¦‚è¦
é‡‘èæ©Ÿé–¢æ¤œç´¢APIã®ã€ŒéŠ€è¡Œãã‚“ã€ã‚’ä½¿ç”¨ã—ã¦ã€éŠ€è¡ŒæŒ¯è¾¼ãƒ•ã‚©ãƒ¼ãƒ ã‚’å®Ÿè£…ã—ã¦ã¿ãŸã„ã¨æ€ã„ã¾ã™ã€‚
ä»Šå›ã€APIã‚’ä½¿ç”¨ã™ã‚‹ç®‡æ‰€ã¨ã—ã¦ã¯ã€ä»¥ä¸‹ã«ãªã‚Šã¾ã™ã€‚
- éŠ€è¡Œåã‚’å…¥åŠ›ã™ã‚‹ãƒ•ã‚©ãƒ¼ãƒ ã§ã€1æ–‡å­—ãšã¤apiã‚’å©ã„ã¦ã€ä¸€è‡´ã™ã‚‹éŠ€è¡Œåã®å€™è£œã‚’ãƒªã‚¹ãƒˆå½¢å¼ã§è¡¨ç¤ºã—ã¾ã™ã€‚
- æ”¯åº—ã‚³ãƒ¼ãƒ‰ã®å…¥åŠ›ãŒå®Œäº†ã—ãŸã‚‰ã€æ”¯åº—åã‚’è¡¨ç¤ºã•ã›ã‚‹ã€‚

https://bank.teraren.com/
## ä½¿ç”¨æŠ€è¡“
- React (18.2.0)
- ã€ŒéŠ€è¡Œãã‚“ã€é‡‘èæ©Ÿé–¢æ¤œç´¢API (0.1.6)

## ãƒ‡ãƒ¢
codesandboxã‚’ä½¿ç”¨ã—ã¦ã€ãƒ‡ãƒ¢ã‚’å®Ÿè£…ã—ã¦ã¿ã¾ã—ãŸã€‚
[![Image from Gyazo](https://i.gyazo.com/d2011bb9db1d63b1bf5835ef1aeb5b9e.gif)](https://gyazo.com/d2011bb9db1d63b1bf5835ef1aeb5b9e)
https://r2tzyz-3000.csb.app/
https://codesandbox.io/p/github/ippei-shimizu/bank-name-search-form-codesandbox/main?embed=1&file=%2Fsrc%2Findex.js
[githubã¯ã“ã¡ã‚‰](https://github.com/ippei-shimizu/bank-name-search-form-codesandbox)
## ã‚³ãƒ¼ãƒ‰
```jsx
import { useState, useEffect } from "react";
import "./styles.css";

export default function App() {
  const [bankName, setBankName] = useState("");
  const [suggestedBanks, setSuggestedBanks] = useState([]);
  const [isFocused, setIsFocused] = useState(false);
  const [isSuggestedOpen, setIsSuggestedOpen] = useState(true);
  const [bankCode, setBankCode] = useState("");
  const [branchCode, setBranchCode] = useState("");
  const [branchName, setBranchName] = useState("");
  const [allBanks, setAllBanks] = useState([]);

  useEffect(() => {
    const fetchAllBanks = async () => {
      let fetchedBanks = [];
      let currentPage = 1;
      let hasMore = true;

      while (currentPage <= 24) {
        const api = `https://bank.teraren.com/banks.json?page=${currentPage}`;
        const response = await fetch(api);
        const data = await response.json();

        if (data && data.length > 0) {
          fetchedBanks = fetchedBanks.concat(data);
          currentPage += 1;
        } else {
          break;
        }
      }
      setAllBanks(fetchedBanks);
    };
    fetchAllBanks();
  }, []);

  // éŠ€è¡Œåæ¤œç´¢ã§ã€å…¥åŠ›å€¤ã«ä¸€è‡´ã™ã‚‹ãƒ‡ãƒ¼ã‚¿ã‚’ã‚µã‚¸ã‚§ã‚¹ãƒˆã§è¡¨ç¤ºã•ã›ã‚‹
  const handleBankNameInputChange = async (e) => {
    setIsSuggestedOpen(true);
    const value = e.target.value;
    setBankName(value);

    if (value) {
      const filteredData = allBanks.filter(
        (bank) =>
          bank.name.includes(value) ||
          bank.hira.includes(value) ||
          bank.kana.includes(value),
      );
      setSuggestedBanks(filteredData);
    } else {
      setSuggestedBanks([]);
    }
  };

  // focusã‚’åˆ¤å®š
  const handleFocus = () => {
    setIsFocused(true);
  };
  const handleBlur = () => {
    setIsFocused(false);
  };

  const bankNameMessage = () => {
    if (!isFocused && bankName.length === 0) return null;
    if (bankName.length === 0 || suggestedBanks.length === 0) {
      return <li className="error-text">è©²å½“ã®éŠ€è¡Œã¯è¦‹ã¤ã‹ã‚Šã¾ã›ã‚“</li>;
    }
    return suggestedBanks.map((bank) => (
      <li
        key={bank.code}
        className="bank-name"
        onClick={() => handleBankNameClick(bank.normalize.name, bank.code)}
      >
        {bank.normalize.name}
      </li>
    ));
  };

  // ã‚µã‚¸ã‚§ã‚¹ãƒˆã•ã‚ŒãŸéŠ€è¡Œåã‚’é¸æŠ
  const handleBankNameClick = (name, code) => {
    setBankName(name);
    setBankCode(code);
    setSuggestedBanks([]);
    setIsSuggestedOpen(false);
  };

  // æ”¯åº—åå…¥åŠ›
  const fetchAllBranches = async (bankCode) => {
    let allBranches = [];
    let currentPage = 1;
    let hasMore = true;

    while (hasMore) {
      const api = `https://bank.teraren.com/banks/${bankCode}/branches.json?page=${currentPage}`;
      const response = await fetch(api);
      const data = await response.json();

      if (data && data.length > 0) {
        allBranches = allBranches.concat(data);
        currentPage++;
      } else {
        hasMore = false;
      }
    }
    return allBranches;
  };

  const handleBranchNameChange = async (e) => {
    const value = e.target.value;
    setBranchName(value);

    if (bankCode.length === 4) {
      const branches = await fetchAllBranches(bankCode);
      const branch = branches.find((branch) => branch.name.includes(value));
      if (branch) {
        setBranchCode(branch.code);
      } else {
        setBranchCode("");
      }
    }
  };

  // æ”¯åº—ã‚³ãƒ¼ãƒ‰å…¥åŠ›
  const handleBranchCodeChange = async (e) => {
    const value = e.target.value;
    setBranchCode(value);

    if (bankCode.length === 4 && value.length === 3) {
      fetch(`https://bank.teraren.com/banks/${bankCode}/branches/${value}.json`)
        .then((response) => response.json())
        .then((json) => {
          setBranchName(json.name);
        })
        .catch((error) => {
          setBranchName("");
        });
    }
  };

  return (
    <>
      <form className="form">
        <div>
          <label htmlFor="searchBank">éŠ€è¡Œå</label>
          <input
            id="searchBank"
            className="input-form"
            placeholder="éŠ€è¡Œåã‚’æ¤œç´¢ã™ã‚‹"
            value={bankName}
            onChange={handleBankNameInputChange}
            onFocus={handleFocus}
            onBlur={handleBlur}
          ></input>
          {isSuggestedOpen ? (
            <ul className="bank-name-suggested">{bankNameMessage()}</ul>
          ) : (
            ""
          )}
        </div>
        <div className="form-box-code">
          <label htmlFor="BankCode">é‡‘èæ©Ÿé–¢ã‚³ãƒ¼ãƒ‰</label>
          <input
            id="BankCode"
            className="input-form"
            placeholder="ä¾‹ï¼‰0001"
            value={bankCode}
          ></input>
        </div>
        <div className="form-box-branch">
          <label htmlFor="inputBranchName">æ”¯åº—å</label>
          <input
            id="inputBranchName"
            className="input-form"
            placeholder="ä¾‹ï¼‰ä¸¸ã®å†…ä¸­å¤®"
            type="text"
            value={branchName}
            onChange={handleBranchNameChange}
          ></input>
        </div>
        <div className="form-box">
          <label htmlFor="inputBranchCode">æ”¯åº—ã‚³ãƒ¼ãƒ‰</label>
          <input
            id="inputBranchCode"
            className="input-form"
            placeholder="ä¾‹ï¼‰000"
            type="text"
            value={branchCode}
            onChange={handleBranchCodeChange}
          ></input>
        </div>
      </form>
    </>
  );
}
```