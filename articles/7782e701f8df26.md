---
title: "ハンズオン！Next.js+Hono+RPC+Supabase+Drizzle+pnpm+Turborepoで作るモノレポ構成のアプリ開発"
emoji: "🔥"
type: "tech" # tech: 技術記事 / idea: アイデア
topics: ["Nextjs", "TypeScript", "Hono", "pnpm"]
published: false
---

## はじめに

プログラミングスクールRUNTEQでWebエンジニア兼講師をしているいっぺい（[@ippei_111](https://x.com/ippei_111)）と申します。

今回は、TypeScriptを使用して、Next.js+Hono+RPC+Supabase+Drizzle+pnpm+Turborepoのモノレポ構成のアプリを作成する方法をハンズオン形式で紹介していきます。

本記事で作成するアプリは、フロントエンドはNext.jsのApp Router、バックエンドはHonoフレームワークを使用し、Cloudflare Workersにデプロイします。データベースはSupabaseのPostgreSQLを利用し、ORM/クエリビルダーとしてDrizzleを採用しています。

## アプリケーションの概要
### 完成系のイメージ

### 概要
今回は、ハンズオン形式で、Next.js+Hono+RPC+Supabase+Drizzle+pnpm+Turborepoのモノレポ構成のアプリを作成することを目的とするため、基本的な記事のCRUD機能を持つアプリケーションを開発します。

### やらないこと
- 認証機能
- スタイリング
- テストコード

### アーキテクチャ
- モノレポ構成
- フロントエンド : Next.js App Routerを使用して、Vercelにデプロイ
- バックエンド : Honoを使用して、Cloudflare Workersにデプロイ
- データベース : Supabase
- ORM/クエリビルダー : Drizzle
- プロジェクト管理 : pnpm WorkspaceとTurborepo

### ディレクトリ構成

ディレクトリ構成は以下を想定しています。

```bash
/
├── .turbo/
├── node_modules/
├── packages/
│   ├── api/                     # Honoバックエンド
│   │   ├── src/
│   │   │   ├── routes/          # Honoルーティング
│   │   │   ├── schemas/         # Zodスキーマ
│   │   │   └── types/           # 共通の型定義
│   │   ├── supabase/
│   │   ├── .dev.vars
│   │   ├── .prod.vars
│   │   ├── drizzle.config.ts
│   │   └── wrangler.jsonc
│   │
│   └── frontend/                # Next.jsフロントエンド
│       ├── src/
│       │   ├── app/             # Next.js App Router
│       │   │   ├── services/    # サーバーコンポーネントで使用するAPI通信
│       │   └── lib/             # クライアント用ユーティリティ
│       ├── public/
│       └── middleware.ts
├── package.json
├── pnpm-lock.yaml
├── pnpm-workspace.yaml
├── tsconfig.json
└── turbo.json
```
- `node_modules/` : プロジェクト全体の共有依存関係
- `package.json` : ルートレベルの依存関係と共通スクリプトを定義
- `pnpm-workspace.yaml` : pnpmのワークスペース設定
- `turbo.json` : Turborepoの設定
- `packages/api` : Honoバックエンドのソースコードを格納するディレクトリ
  - `src/routes` : Honoのルーティングを格納するディレクトリ
  - `src/schemas` : Zodスキーマを格納するディレクトリ
  - `src/types` : 共通の型定義を格納するディレクトリ
  - `supabase` : Supabaseローカル開発環境の設定ファイルを格納するディレクトリ
  - `wrangler.jsonc` : Cloudflare Workersの設定ファイル
- `packages/frontend` : Next.jsフロントエンドのソースコードを格納するディレクトリ
  - `src/services` : サーバーコンポーネントで使用するAPI通信を格納するディレクトリ
  - `src/lib` : APIクライアントを格納するディレクトリ

### 技術スタック
今回、使用する技術スタックは以下の通りになります。

| カテゴリ | 技術 |
| ---- | ---- |
| フロントエンド | Next.js 15.2.4 / React 19.0.0 / TypeScript 5.0 |
| バックエンド | Hono 4.7.5 |
| データベース | Supabase / Drizzle ORM 0.41.0 |
| プロジェクト管理 | pnpm 10.6.3 / Turborepo 2.4.4 |
| デプロイ | Vercel / Cloudflare Workers |

## モノレポ構成を採用した理由
モノレポ（Monorepo）は、複数のプロジェクトを1つのリポジトリで管理する手法です。今回は、フロントエンド（Next.js）とバックエンド（Hono）を同じリポジトリで管理することで、型やバリデーションの共有を容易にし、開発効率を向上させていきたいと考え、モノレポ構成を採用しました。

### 🙆‍♂️ モノレポ構成を採用するメリット

モノレポのメリットについて、技術的な観点で感じたことを以下にまとめてみました。

**◼︎ 型共有**
今回、TypeScriptを使用してフロントエンドとバックエンドを開発するため、APIレスポンスの型や入力値の型をフロントエンドとバックエンドで共有することで、型不一致によるバグを防ぐことができます。

**◼︎ LintやFormatの一元管理**
ESLintやPrettierなどの設定ファイルをルートに配置することで、全てのプロジェクト・パッケージで同じルールを適用することができます。

**◼︎ issueやPull Requestの一元管理**
今回のアプリケーションのように、フロントエンドとバックエンドにまたがる開発を行う場合、1つのリポジトリでissueやPull Requestを管理することは開発の管理を容易にします。

### 🙅‍♂️ モノレポ構成を採用するデメリット
モノレポのデメリットとしては、プロジェクトが大きくなるにつれてリポジトリサイズが大きくなり、プロジェクト間の依存関係が複雑になってしまう可能性があります。

## サーバレスアーキテクチャを採用した理由
サーバーレスアーキテクチャは、サーバー管理や運用をプロバイダーが行うため、開発者はサーバーについて考える必要がなくなり、アプリケーションのコードに集中することができるようになるアーキテクチャです。
今回、バックエンドのHonoの実行環境として、Cloudflare Workersを選択した理由としては、個人開発のアプリケーションになるため、できるだけ運用コストを抑えたかったのが1番の理由です。
Cloudflare Workersは無料プランがあり、2025年4月現在では「1日あたり10万リクエスト、1分あたり1,000リクエスト」まで無料で使用することができます。

https://developers.cloudflare.com/workers/platform/pricing/

### 🙆‍♂️ サーバレスアーキテクチャを採用するメリット

**◼︎ 使用したリソースのみ課金される**
無料枠が提供されているかつ、従量課金制になるため、使用した分だけ費用が発生します。そのため、運用コストを予測しやすく、小規模プロジェクトでは無料で運用することが可能です。

**◼︎ 自動スケーリング**
トラフィックの量に応じて自動的にスケールしてくれるため、スケーリングに関する運用負荷を軽減することができます。

### 🙅‍♂️ サーバレスアーキテクチャを採用するデメリット

**◼︎ コールドスタート**
長時間リクエストがされていない関数が呼び出されると、初期化に時間がかかることがあります。

**◼︎ 実行時間に制限がある**
多くのサーバーレスプロバイダーには、実行時間の制限があります。

## ハンズオン
では、さっそくハンズオン形式でアプリケーションを実際に作成していきます。

### 1. 環境構築

## 参考文献
https://hono.dev/
https://www.cloudflare.com/ja-jp/developer-platform/products/workers/
https://zenn.dev/yasse/articles/2650d580ae8392
