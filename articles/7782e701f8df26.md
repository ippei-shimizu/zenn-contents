---
title: "ハンズオン！Next.js+Hono+RPC+Supabase+Drizzle+pnpm+Turborepoで作るモノレポ構成のアプリ開発"
emoji: "🔥"
type: "tech" # tech: 技術記事 / idea: アイデア
topics: ["Nextjs", "TypeScript", "Hono", "pnpm"]
published: false
---

## はじめに

プログラミングスクールRUNTEQでWebエンジニア兼講師をしているいっぺい（[@ippei_111](https://x.com/ippei_111)）と申します。

今回は、TypeScriptを使用して、Next.js+Hono+RPC+Supabase+Drizzle+pnpm+Turborepoのモノレポ構成のアプリを作成する方法をハンズオン形式で紹介していきます。

本記事で作成するアプリは、フロントエンドはNext.jsのApp Router、バックエンドはHonoフレームワークを使用し、Cloudflare Workersにデプロイします。データベースはSupabaseのPostgreSQLを利用し、ORM/クエリビルダーとしてDrizzleを採用しています。モノレポ構成のプロジェクト管理にはpnpm WorkspaceとTurborepoを使用します。

## Honoとは

https://hono.dev/


## Hono RPCとは

https://hono.dev/docs/guides/rpc

## pnpm Workspaceとは

https://pnpm.io/ja/workspaces

## Turborepoとは

https://turbo.build/

## アプリケーションの概要
### 完成系のイメージ

### 概要
今回は、ハンズオン形式で、Next.js+Hono+RPC+Supabase+Drizzle+pnpm+Turborepoのモノレポ構成のアプリを作成することを目的とするため、基本的な記事のCRUD機能を持つアプリケーションを開発します。

### やらないこと
- 認証機能
- スタイリング
- テストコード

### アーキテクチャ
- モノレポ構成
- フロントエンド : Next.js App Routerを使用して、Vercelにデプロイ
- バックエンド : Honoを使用して、Cloudflare Workersにデプロイ
- データベース : Supabase
- ORM/クエリビルダー : Drizzle
- プロジェクト管理 : pnpm WorkspaceとTurborepo

### ディレクトリ構成

ディレクトリ構成は以下を想定しています。

```bash
/
├── .turbo/
├── node_modules/
├── packages/
│   ├── api/                     # Honoバックエンド
│   │   ├── src/
│   │   │   ├── routes/          # Honoルーティング
│   │   │   ├── schemas/         # Zodスキーマ
│   │   │   └── types/           # 共通の型定義
│   │   ├── supabase/
│   │   ├── .dev.vars
│   │   ├── .prod.vars
│   │   ├── drizzle.config.ts
│   │   └── wrangler.jsonc
│   │
│   └── frontend/                # Next.jsフロントエンド
│       ├── src/
│       │   ├── app/             # Next.js App Router
│       │   │   ├── services/    # サーバーコンポーネントで使用するAPI通信
│       │   └── lib/             # クライアント用ユーティリティ
│       ├── public/
│       └── middleware.ts
├── package.json
├── pnpm-lock.yaml
├── pnpm-workspace.yaml
├── tsconfig.json
└── turbo.json
```
- `node_modules/` : プロジェクト全体の共有依存関係
- `package.json` : ルートレベルの依存関係と共通スクリプトを定義
- `pnpm-workspace.yaml` : pnpmのワークスペース設定
- `turbo.json` : Turborepoの設定
- `packages/api` : Honoバックエンドのソースコードを格納するディレクトリ
  - `src/routes` : Honoのルーティングを格納するディレクトリ
  - `src/schemas` : Zodスキーマを格納するディレクトリ
  - `src/types` : 共通の型定義を格納するディレクトリ
  - `supabase` : Supabaseローカル開発環境の設定ファイルを格納するディレクトリ
  - `wrangler.jsonc` : Cloudflare Workersの設定ファイル
- `packages/frontend` : Next.jsフロントエンドのソースコードを格納するディレクトリ
  - `src/services` : サーバーコンポーネントで使用するAPI通信を格納するディレクトリ
  - `src/lib` : APIクライアントを格納するディレクトリ

### 技術スタック
今回、使用する技術スタックは以下の通りになります。

| カテゴリ | 技術 |
| ---- | ---- |
| フロントエンド | Next.js 15.2.4 / React 19.0.0 / TypeScript 5.0 |
| バックエンド | Hono 4.7.5 |
| データベース | Supabase / Drizzle ORM 0.41.0 |
| プロジェクト管理 | pnpm 10.6.3 / Turborepo 2.4.4 |
| デプロイ | Vercel / Cloudflare Workers |

## モノレポ構成を採用した理由
モノレポ（Monorepo）は、複数のプロジェクトを1つのリポジトリで管理する手法です。今回は、フロントエンド（Next.js）とバックエンド（Hono）を同じリポジトリで管理することで、型やバリデーションの共有を容易にし、開発効率を向上させていきたいと考え、モノレポ構成を採用しました。

### 🙆‍♂️ モノレポ構成を採用するメリット

モノレポのメリットについて、技術的な観点で感じたことを以下にまとめてみました。

**◼︎ 型共有**
今回、TypeScriptを使用してフロントエンドとバックエンドを開発するため、APIレスポンスの型や入力値の型をフロントエンドとバックエンドで共有することで、型不一致によるバグを防ぐことができます。

**◼︎ LintやFormatの一元管理**
ESLintやPrettierなどの設定ファイルをルートに配置することで、全てのプロジェクト・パッケージで同じルールを適用することができます。

**◼︎ issueやPull Requestの一元管理**
今回のアプリケーションのように、フロントエンドとバックエンドにまたがる開発を行う場合、1つのリポジトリでissueやPull Requestを管理することは開発の管理を容易にします。

### 🙅‍♂️ モノレポ構成を採用するデメリット
モノレポのデメリットとしては、プロジェクトが大きくなるにつれてリポジトリサイズが大きくなり、プロジェクト間の依存関係が複雑になってしまう可能性があります。

## サーバレスアーキテクチャを採用した理由
サーバーレスアーキテクチャは、サーバー管理や運用をプロバイダーが行うため、開発者はサーバーについて考える必要がなくなり、アプリケーションのコードに集中することができるようになるアーキテクチャです。
今回、バックエンドのHonoの実行環境として、Cloudflare Workersを選択した理由としては、個人開発のアプリケーションになるため、できるだけ運用コストを抑えたかったのが1番の理由です。
Cloudflare Workersは無料プランがあり、2025年4月現在では「1日あたり10万リクエスト、1分あたり1,000リクエスト」まで無料で使用することができます。

https://developers.cloudflare.com/workers/platform/pricing/

### 🙆‍♂️ サーバレスアーキテクチャを採用するメリット

**◼︎ 使用したリソースのみ課金される**
無料枠が提供されているかつ、従量課金制になるため、使用した分だけ費用が発生します。そのため、運用コストを予測しやすく、小規模プロジェクトでは無料で運用することが可能です。

**◼︎ 自動スケーリング**
トラフィックの量に応じて自動的にスケールしてくれるため、スケーリングに関する運用負荷を軽減することができます。

### 🙅‍♂️ サーバレスアーキテクチャを採用するデメリット

**◼︎ コールドスタート**
長時間リクエストがされていない関数が呼び出されると、初期化に時間がかかることがあります。

**◼︎ 実行時間に制限がある**
多くのサーバーレスプロバイダーには、実行時間の制限があります。

## ハンズオン
では、さっそくハンズオン形式でアプリケーションを実際に作成していきます。

### 1. 環境準備

まず、必要なツールをインストールして開発環境を整えます。
（既にインストール済みの方は、次のステップに進んでください）

#### 前提条件
- Node.js v20.5.1以上がインストールされていること
- pnpm v10.6.3以上がインストールされていること

pnpmのインストールがまだの方は、公式ドキュメントを参考にしてインストールを行なってください。
https://pnpm.io/ja/installation

### 2. モノレポ構成の構築

#### 👨‍💻 プロジェクトの初期化
まず、pnpmを使用してpackage.jsonの初期化を行います。
```bash
$ pnpm init
```

ルートディレクトリに`package.json`が作成されていると思いますので、以下のように変更してください。
```json
{
  "name": "hono-nextjs-monorepo-zenn",
  "version": "1.0.0",
  "description": "",
  "main": "index.js",
  "scripts": {
    "dev": "turbo run dev",
    "build": "turbo run build",
    "test": "echo \"Error: no test specified\" && exit 1",
    "lint": "turbo run lint"
  },
  "devDependencies": {
    "prettier": "^3.5.1",
    "turbo": "2.4.4",
    "typescript": "^5.8.0"
  },
  "keywords": [],
  "author": "",
  "license": "ISC",
  "packageManager": "pnpm@10.7.0"
}
```
- `dev` : 開発サーバーを起動するためのスクリプト
- `build` : ビルドを行うためのスクリプト

#### 👨‍💻 pnpm Workspaceの設定
プロジェクトをpnpm Workspaceとして設定するために、ルートディレクトリに`pnpm-workspace.yaml`を作成します。
```yaml
packages:
  - 'packages/*'
```
この設定により、`packages`ディレクトリ内のすべてのパッケージがpnpm Workspaceとして認識されます。

#### 👨‍💻 Turborepoの設定
Turborepoを設定するために、ルートディレクトリに`turbo.json`を作成します。
```json
{
  "$schema": "https://turbo.build/schema.json",
  "globalDependencies": ["**/.env.*local"],
  "tasks": {
    "build": {
      "dependsOn": ["^build"],
      "outputs": [".next/**", "!.next/cache/**", "dist/**"]
    },
    "lint": {},
    "format": {
      "outputs": []
    },
    "dev": {
      "cache": false,
      "persistent": true
    },
    "clean": {
      "cache": false
    }
  }
}
```
- `globalDependencies` : 全タスクの依存ファイルを指定。環境変数ファイルが変更されるとタスクが再実行されます。
- `tasks` : プロジェクトで実行可能なタスクを定義します。
  - `build.dependsOn` : ビルド前に完了すべき依存タスクを指定。`^build`は「ワークスペース依存関係のビルドを先に実行」を意味します。
  - `build.outputs` : ビルドで生成されるファイル・ディレクトリを指定。キャッシュ対象となります。
  - `dev.cache: false` : 開発サーバーの結果はキャッシュしないように設定しています。
  - `dev.persistent: true` : 開発サーバーが常駐プロセスとして実行されることを示します。

これらの設定により、パッケージ間の依存関係を考慮したビルドやキャッシュが可能になります。

#### 👨‍💻 共通のTypeScript設定
ルートディレクトリに`tsconfig.json`を作成します。
```json
{
  "compilerOptions": {
    "target": "ES2022",
    "lib": ["dom", "dom.iterable", "esnext"],
    "allowJs": true,
    "skipLibCheck": true,
    "strict": true,
    "forceConsistentCasingInFileNames": true,
    "noEmit": true,
    "esModuleInterop": true,
    "module": "esnext",
    "moduleResolution": "bundler",
    "resolveJsonModule": true,
    "isolatedModules": true,
    "jsx": "preserve",
    "incremental": true,
    "plugins": [
      {
        "name": "next"
      }
    ]
  },
  "exclude": ["node_modules"]
}
```
こちらの詳細なオプションについては、公式ドキュメントを参考にしてください。
https://www.typescriptlang.org/tsconfig/

### 3. バックエンドアプリケーションの構築（Hono）
#### 👨‍💻 Honoのインストール
`packages`ディレクトリにHonoアプリケーションを構築します。
バックエンドアプリケーション名は`api`とします。
```bash
$ cd packages
```
```bash
$ pnpm create hono@latest
```
👇Hono - Quick Start
https://hono.dev/docs/#quick-start
`pnpm create hono@latest`を実行すると、Honoの初期設定に関する質問がいくつか表示されるので、以下のように回答してください。
![](/images/create-hono-success.png)
✅ Target directory : `api`
✅ Which template do you want to use? : `cloudflare-workers`
✅ Do you want to install project dependencies? : `Yes`
✅ Which package manager do you want to use? : `pnpm`

これだけで、Honoアプリケーションのインストールが完了します。
次に、ルートディレクトリに戻り、`pnpm dev`を実行して、Honoアプリケーションが正しく動作するか確認してください。
```bash
$ cd ..
$ pnpm dev
```
👇ターミナル
![](/images/pnpm-dev-hono.png)
http://localhost:8787 にアクセスして、以下のような画面が表示されれば成功です。
![](/images/hello-hono.png)

### 4. フロントエンドアプリケーションの構築（Next.js）
#### 👨‍💻 Next.jsのインストール
次に、フロントエンドアプリケーションを構築します。
フロントエンドアプリケーション名は`frontend`とします。
```bash
$ cd packages
```
```bash
$ npx create-next-app@latest
```
👇Next.js - Automatic installation
https://nextjs.org/docs/app/getting-started/installation#automatic-installation
`npx create-next-app@latest`を実行すると、Next.jsの初期設定に関する質問がいくつか表示されるので、以下のように回答してください。
![](/images/create-next-app.png)

✅ What is your project named? : `frontend`
✅ Would you like to use TypeScript? : `Yes`
✅ Would you like to use ESLint? : `Yes`
✅ Would you like to use Tailwind CSS? : `Yes`
✅ Would you like your code inside a `src/` directory? : `Yes`
✅ Would you like to use App Router? (recommended) : `Yes`
✅ Would you like to use Turbopack for `next dev`? : `Yes`
✅ Would you like to customize the import alias (`@/*` by default)? : `No`

ルートディレクトリに戻り、一度開発サーバーを停止してから、再度`pnpm dev`を実行してください。
```bash
$ pnpm dev
```
http://localhost:3000 にアクセスして、Next.jsの初期画面が表示されれば成功です。

これで、モノレポ構成でバックエンド（Hono）とフロントエンド（Next.js）のアプリケーションがそれぞれ構築することができました。




## 参考文献
https://zenn.dev/yasse/articles/2650d580ae8392
